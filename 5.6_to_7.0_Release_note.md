# PHP 5.6 to 7.0  news

## Scalar type declarations

Khai b√°o ki·ªÉu v√¥ h∆∞·ªõng c√≥ hai lo·∫°i: c∆∞·ª°ng ch·∫ø (m·∫∑c ƒë·ªãnh) v√† nghi√™m ng·∫∑t

### Ch·∫ø ƒë·ªô c∆∞·ª°ng ch·∫ø(Coercive mode)

```php
<?php
// Coercive mode
function sumOfInts(int ...$ints)
{
    return array_sum($ints); // $ints = [0 => 2, 1 => 3, 0 => 4]
}

var_dump(sumOfInts(2, '3', 4.1)); // int(9)
```

### Ch·∫ø ƒë·ªô nghi√™m ng·∫∑t(Strict mode)

```php
<?php
// Strict mode
declare(strict_types=1);
function sumOfInts(int ...$ints)
{
    return array_sum($ints);
}

var_dump(sumOfInts(2, '3', 4.1));
```

> Fatal error: Uncaught TypeError: sumOfInts(): Argument #2 must be of type int, string given

## Return type declarations

H·ªó tr·ª£ khai b√°o ki·ªÉu tr·∫£ v·ªÅ - Ch·ªâ ƒë·ªãnh ki·ªÉu tr·∫£ v·ªÅ c·ªßa m·ªôt h√†m

```php
<?php
function helloWorld(): string
{
    return 'Hello World';
}
```

### C√°c ki·ªÉu tr·∫£ v·ªÅ ch∆∞a ƒë∆∞·ª£c h·ªó tr·ª£

| Return type | Support version | Description |
| ------ | ------ | ------ |
| [nullable](./7.0_to_7.1_Release_note.md#new-return-types) | 7.1.0 | VD: ?string th√¨ c√≥ th·ªÉ tr·∫£ v·ªÅ string ho·∫∑c null |
| [void](./7.0_to_7.1_Release_note.md#new-return-types) | 7.1.0 | Th√™m ki·ªÉu tr·∫£ v·ªÅ void |
| [iterable](./7.0_to_7.1_Release_note.md#new-return-types) | 7.1.0 | Th√™m ki·ªÉu tr·∫£ v·ªÅ iterable: function gen(): iterable { yield 1; } |
| [object](./7.1_to_7.2_Release_note.md#them-object-type) | 7.2.0 | Th√™m ki·ªÉu tr·∫£ v·ªÅ object |
| union | 8.0.0 |  Th√™m ki·ªÉu tr·∫£ v·ªÅ union: function gen(): int\|float\|ClassA { return 1; } |
| static | 8.0.0 |  Th√™m ki·ªÉu tr·∫£ v·ªÅ static |
| mixed | 8.0.0 |  Th√™m ki·ªÉu tr·∫£ v·ªÅ mixed |
| never | 8.1.0 |  Th√™m ki·ªÉu tr·∫£ v·ªÅ never |
| void | 8.1.0 | Ki·ªÉu tr·∫£ v·ªÅ void s·∫Ω b·ªã ƒë√°nh d·∫•u l√† deprecated khi khai b√°o ki·ªÉu tr·∫£ v·ªÅ kh√¥ng ƒë·ªìng nh·∫•t gi·ªØa c√°c class cha con|
| Intersection | 8.1.0 | Th√™m ki·ªÉu d·ªØ li·ªáu intersection(Giao l·ªô): function gen(Iterator\&\\Countable \$value): int { return count($value); } |
| null,false | 8.2.0 | Tr∆∞·ªõc phi√™n b·∫£n 8.2.0, ch·ªâ c√≥ th·ªÉ tr·∫£ v·ªÅ null ho·∫∑c false nh∆∞ 1 ph·∫ßn c·ªßa ki·ªÉu tr·∫£ v·ªÅ union |
| true | 8.2.0 | Th√™m ki·ªÉu tr·∫£ v·ªÅ true |
| DNF | 8.2.0 | Th√™m ki·ªÉu tr·∫£ v·ªÅ DNF: tr·∫£ v·ªÅ A\|B\|(C\&D) ho·∫∑c (A\&B\&C)\|null ... |
| ... | 8.3.0 | Th√™m ki·ªÉu tr·∫£ v·ªÅ cho interface, trait, th√™m ki·ªÉu d·ªØ li·ªáu cho constant trong enum |

## Null coalescing operator

To√°n t·ª≠ h·ª£p nh·∫•t null

```php
<?php
$username = $_GET['user'] ?? 'nobody';
// ƒêi·ªÅu n√†y t∆∞∆°ng ƒë∆∞∆°ng v·ªõi
$username = isset($_GET['user']) ? $_GET['user'] : 'nobody';
// C√≥ th·ªÉ s·ª≠ d·ª•ng n·ªëi ti·∫øp
$username = $_GET['user'] ?? $_POST['user'] ?? 'nobody';
```

## Spaceship operator

To√°n t·ª≠ spaceship ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ so s√°nh hai bi·ªÉu th·ª©c.
N√≥ tr·∫£ v·ªÅ -1, 0 ho·∫∑c 1 khi $a l·∫ßn l∆∞·ª£t nh·ªè h∆°n, b·∫±ng ho·∫∑c l·ªõn h∆°n $b

```php
<?php
// Integers
echo 1 <=> 1; // 0
echo 1 <=> 2; // -1
echo 2 <=> 1; // 1

// Floats
echo 1.5 <=> 1.5; // 0
echo 1.5 <=> 2.5; // -1
echo 2.5 <=> 1.5; // 1
 
// Strings
echo "a" <=> "a"; // 0
echo "a" <=> "b"; // -1
echo "b" <=> "a"; // 1
```

## C√≥ th·ªÉ khai b√°o h·∫±ng s·ªë l√† m·∫£ng v·ªõi h√†m define()

Trong php 5.6, ch·ªâ c√≥ th·ªÉ s·ª≠ d·ª•ng v·ªõi t·ª´ kho√° const

## Anonymous classes

H·ªó tr·ª£ cho c√°c l·ªõp ·∫©n danh ƒë√£ ƒë∆∞·ª£c th√™m v√†o th√¥ng qua `new class`.
Ch√∫ng c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng thay cho c√°c ƒë·ªãnh nghƒ©a l·ªõp ƒë·∫ßy ƒë·ªß cho c√°c ƒë·ªëi t∆∞·ª£ng d√πng m·ªôt l·∫ßn

```php
<?php
interface Logger {
    public function log(string $msg);
}

class Application {
    private $logger;
    public function __construct(Logger $logger) {
        $this->logger = $logger;
    }
    public function getLogger(): Logger {
        return $this->logger;
    }
}

$app = new Application(new class implements Logger {
    public function log(string $msg) {
        echo $msg;
    }
});

var_dump($app->getLogger());
```

> object(class@anonymous)#2 (0) {}

## Unicode codepoint escape syntax

C√∫ ph√°p n√†y cho ph√©p khai b√°o c√°c k√Ω t·ª± Unicode d∆∞·ªõi dang \u + m√£ unicode h·ª£p l·ªá.
V·ªõi c√°c m√£ Unicode b·∫Øt ƒë·∫ßu b·∫±ng s·ªë 0 th√¨ s·ªë 0 c√≥ th·ªÉ c√≥ ho·∫∑c kh√¥ng.
C√≥ th·ªÉ s·ª≠ d·ª•ng v·ªõi c√∫ ph√°p heredoc

```php
<?php

echo "\u{aa}", PHP_EOL; // k√Ω t·ª± ¬™, php 6 ch·ªâ ouput \u{aa}
echo "\u{0000aa}", PHP_EOL; // k√Ω t·ª± ¬™
// K·∫øt qu·∫£ c·ªßa 2 d√≤ng tr√™n t∆∞∆°ng ƒë∆∞∆°ng v·ªõi ƒëo·∫°n code sau trong php 5(>5.4.0)
echo html_entity_decode('&#xAA;'), PHP_EOL; // v·∫´n ho·∫°t ƒë·ªông ƒë·ªëi v·ªõi php 7

echo "\u{9999}", PHP_EOL; // È¶ô
// K·∫øt qu·∫£ t∆∞∆°ng ƒë∆∞∆°ng v·ªõi ƒëo·∫°n code sau trong php 5(>5.4.0)
echo html_entity_decode('&#x9999;'), PHP_EOL; // È¶ô

// Kh√¥ng th·ªÉ s·ª≠ d·ª•ng c√∫ ph√°p heredoc trong php 5
echo <<<EOT
\u{01f418}
EOT; // üêò

```

## Closure::call()

Closure::call() l√† c√°ch vi·∫øt t·∫Øt hi·ªáu su·∫•t cao h∆°n ƒë·ªÉ t·∫°m th·ªùi li√™n k·∫øt ph·∫°m vi ƒë·ªëi t∆∞·ª£ng v·ªõi m·ªôt closure v√† g·ªçi n√≥.

```php
<?php
class A {private $x = 1;}

// Pre PHP 7 code
$getX = function() {return $this->x;};
$getXCB = $getX->bindTo(new A, 'A'); // intermediate closure
echo $getXCB(); // 1

// PHP 7+ code
$getX = function() {return $this->x;};
echo $getX->call(new A); // 1
```

## Filtered unserialize()

Cung c·∫•p tham s·ªë th·ª© 2 $options l√† m·ªôt m·∫£ng k·∫øt h·ª£p. Cho ph√©p l·ªçc c√°c ƒë·ªëi t∆∞·ª£ng c√≥ th·ªÉ ƒë∆∞·ª£c unserialize, tr√°nh c√°c d·ªØ li·ªáu ƒë·ªôc h·∫°i

V√≠ d·ª• cho ƒëo·∫°n code sau:

```php
<?php
class MyClass {}
$foo = serialize(new MyClass);
```

```php
// Chuy·ªÉn ƒë·ªïi t·∫•t c·∫£ ƒë·ªëi t∆∞·ª£ng th√†nh __PHP_Incomplete_Class object
// => class d·∫∑c bi·ªát, xu·∫•t hi·ªán khi c·ªë g·∫Øng kh√¥i ph·ª•c 1 object t·ª´ 1 chu·ªói m√† php kh√¥ng th·ªÉ t√¨m th·∫•y
var_dump(unserialize($foo, ["allowed_classes" => false]));
// Chuy·ªÉn ƒë·ªïi t·∫•t c·∫£ ƒë·ªëi t∆∞·ª£ng th√†nh __PHP_Incomplete_Class object, ch·ªâ ch·∫•p nh·∫≠n class MyClass v√† MyClass2
var_dump(unserialize($foo, ["allowed_classes" => ["MyClass", "MyClass2"]]));
```

K·∫øt qu·∫£:

```text
object(__PHP_Incomplete_Class)#2 (1) {
  ["__PHP_Incomplete_Class_Name"]=>
  string(7) "MyClass"
}
```

```php
// H√†nh vi m·∫∑c ƒë·ªãnh (gi·ªëng nh∆∞ b·ªè qua ƒë·ªëi s·ªë th·ª© hai) ch·∫•p nh·∫≠n t·∫•t c·∫£ c√°c l·ªõp
$data = unserialize($foo, ["allowed_classes" => true]);
```

K·∫øt qu·∫£:

```text
object(MyClass)#2 (0) {
}
```

## New class IntlChar

Class IntlChar m·ªõi ƒë·ªãnh nghƒ©a m·ªôt s·ªë ph∆∞∆°ng th·ª©c tƒ©nh v√† h·∫±ng s·ªë c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ thao t√°c c√°c k√Ω t·ª± unicode

**NOTE:** Y√™u c·∫ßu ti·ªán √≠ch m·ªü r·ªông *Intl*

## Expectations

N·∫øu c·∫•u h√¨nh ```ini_set('assert.exception', 1);``` th√¨ khi ƒëi·ªÅu ki·ªán trong h√†m assert l√† true th√¨ s·∫Ω b·∫Øn ra AssertionError gi√∫p x·ª≠ l√Ω l·ªói d·ªÖ h∆°n

**NOTE:** ```assert.exception``` b·ªã ƒë√°nh d·∫•u l√† Deprecated k·ªÉ t·ª´ PHP 8.3.0

## Group *use* declarations

C√°c class, h√†m v√† h·∫±ng s·ªë ƒë∆∞·ª£c nh·∫≠p t·ª´ c√πng m·ªôt ```namespace``` gi·ªù ƒë√¢y c√≥ th·ªÉ ƒë∆∞·ª£c nh√≥m l·∫°i v·ªõi nhau trong m·ªôt c√¢u l·ªánh ```use``` duy nh·∫•t

```php
<?php
// Tr∆∞·ªõc PHP 7 code
use some\namespace\ClassA;
use some\namespace\ClassB;
use some\namespace\ClassC as C;

use function some\namespace\fn_a;
use function some\namespace\fn_b;
use function some\namespace\fn_c;

use const some\namespace\ConstA;
use const some\namespace\ConstB;
use const some\namespace\ConstC;

// PHP 7+ code
use some\namespace\{ClassA, ClassB, ClassC as C};
use function some\namespace\{fn_a, fn_b, fn_c};
use const some\namespace\{ConstA, ConstB, ConstC};
```

## Bi·ªÉu th·ª©c tr·∫£ v·ªÅ c·ªßa Generator

Cho ph√©p s·ª≠ d·ª•ng c√¢u l·ªánh return trong Generator ƒë·ªÉ cho ph√©p tr·∫£ v·ªÅ bi·ªÉu th·ª©c cu·ªëi c√πng (kh√¥ng ƒë∆∞·ª£c ph√©p tr·∫£ v·ªÅ theo tham chi·∫øu).
Gi√° tr·ªã n√†y c√≥ th·ªÉ ƒë∆∞·ª£c l·∫•y b·∫±ng ph∆∞∆°ng th·ª©c Generator::getReturn() m·ªõi, ch·ªâ c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng sau khi tr√¨nh t·∫°o ho√†n t·∫•t vi·ªác t·∫°o ra c√°c gi√° tr·ªã.

```php
<?php
$gen = (function() {
    yield 1;
    yield 2;

    return 3;
})();

foreach ($gen as $val) {
    echo $val, PHP_EOL;
}

echo $gen->getReturn(), PHP_EOL;
```

V√≠ d·ª• tr√™n cho k·∫øt qu·∫£ sau:

```text
1
2
3
```

## Generator delegation

Generator hi·ªán c√≥ th·ªÉ chuy·ªÉn giao cho Generator kh√°c, ƒë·ªëi t∆∞·ª£ng Traversable ho·∫∑c m·∫£ng tu·∫ßn t·ª±

```php
<?php
function gen()
{
    yield 1;
    yield 2;
    yield from gen2();
}

function gen2()
{
    yield 3;
    yield 4;
}

foreach (gen() as $val)
{
    echo $val, PHP_EOL;
}
```

ouput

```text
1
2
3
4
```

## Integer division with intdiv()

Th√™m h√†m intdiv ƒë·ªÉ th·ª±c hi·ªán ph√©p chia s·ªë nguy√™n

```php
<?php
var_dump(intdiv(3, 2));
var_dump(intdiv(-3, 2));
var_dump(intdiv(3, -2));
var_dump(intdiv(-3, -2));
var_dump(intdiv(PHP_INT_MAX, PHP_INT_MAX));
var_dump(intdiv(PHP_INT_MIN, PHP_INT_MIN));
var_dump(intdiv(PHP_INT_MIN, -1));
var_dump(intdiv(1, 0));
```

```text
int(1)
int(-1)
int(-1)
int(1)
int(1)
int(1)

Fatal error: Uncaught ArithmeticError: Division of PHP_INT_MIN by -1 is not an integer in %s on line 8
Fatal error: Uncaught DivisionByZeroError: Division by zero in %s on line 9
```

## Session options

[session_start()]([https://](https://www.php.net/manual/en/function.session-start.php)) hi·ªán ch·∫•p nh·∫≠n m·ªôt m·∫£ng c√°c t√πy ch·ªçn ghi ƒë√® l√™n [c√°c ch·ªâ th·ªã c·∫•u h√¨nh session]([https://](https://www.php.net/manual/en/session.configuration.php)) th∆∞·ªùng ƒë∆∞·ª£c ƒë·∫∑t trong php.ini

Xem th√™m [tai ƒë√¢y]([https://](https://www.php.net/manual/en/migration70.new-features.php#migration70.new-features.session-options))

## preg_replace_callback_array()

Th√™m h√†m preg_replace_callback_array() cho ph√©p truy·ªÅn v√†o m·ªôt m·∫£ng g·ªìm key l√† pattern v√† value l√† callback t∆∞∆°ng ·ª©ng. Gi√∫p code t∆∞·ªùng minh v√† s·∫°ch s·∫Ω h∆°n preg_replace_callback().

## random_bytes() & random_int()

Th√™m 2 h√†m m·ªõi [random_bytes()](https://www.php.net/manual/en/function.random-bytes.php) & [random_int()](https://www.php.net/manual/en/function.random-int.php) ƒë·ªÉ t·∫°o ra c√°c s·ªë nguy√™n v√† chu·ªói an to√†n v·ªÅ m·∫∑t m·∫≠t m√£ theo c√°ch ƒëa n·ªÅn t·∫£ng

## H√†m list ho·∫°t ƒë·ªông t·ªët v·ªõi c√°c ƒë·ªëi t∆∞·ª£ng ArrayAccess

Tr∆∞·ªõc ƒë√¢y, [list()](https://www.php.net/manual/en/function.list.php) kh√¥ng ƒë∆∞·ª£c ƒë·∫£m b·∫£o ho·∫°t ƒë·ªông ch√≠nh x√°c v·ªõi c√°c ƒë·ªëi t∆∞·ª£ng tri·ªÉn khai [ArrayAccess](https://www.php.net/manual/en/class.arrayaccess.php). S·ª± c·ªë n√†y ƒë√£ ƒë∆∞·ª£c kh·∫Øc ph·ª•c.

## Clone

```php
(clone $foo)->bar()

// tr∆∞·ªõc php 7
PHP Parse error:  syntax error, unexpected '->' (T_OBJECT_OPERATOR)
// K·ªÉ t·ª´ php 7 tr·ªü ƒëi c√≥ th·ªÉ ho·∫°t ƒë·ªông t·ªët
```
